<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Variables Test - Fluvio Widget</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .test-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-info {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #2196f3;
        }
        
        .variables-display {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            border: 1px solid #e9ecef;
        }
        
        .test-steps {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin: 1rem 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .variable-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .variable-item:last-child {
            border-bottom: none;
        }
        
        .variable-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .variable-value {
            color: #007bff;
            font-family: 'Courier New', monospace;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        h2 {
            color: #34495e;
            margin-top: 0;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="status">ğŸ§ª Dynamic Variables Test</div>
    
    <div class="container">
        <div class="test-header">
            <h1>ğŸ¯ Dynamic Variables Test</h1>
            <p>Testing Fluvio widget with dynamic variables passed via script tag attributes</p>
        </div>

        <div class="test-section">
            <div class="test-info">
                <strong>ğŸ§ª Test Scenario:</strong> Widget with dynamic variables for "FluvioAI Mortgage Company"
                <br><strong>Expected:</strong> Variables should be sent to webhook and passed to Retell agent
                <br><strong>Agent:</strong> Should use company name, agent name, and custom greeting in conversation
            </div>

            <h2>ğŸ“‹ Dynamic Variables Being Tested</h2>
            <div class="variables-display">
                <div class="variable-item">
                    <span class="variable-name">Company Name:</span>
                    <span class="variable-value">"FluvioAI Mortgage Company"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Agent Name:</span>
                    <span class="variable-value">"Sarah"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Agent Title:</span>
                    <span class="variable-value">"Mortgage Specialist"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Company Number:</span>
                    <span class="variable-value">"1-800-MORTGAGE"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Company Hours:</span>
                    <span class="variable-value">"Monday-Friday 9am-6pm EST"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Company Address:</span>
                    <span class="variable-value">"123 Finance Street, Toronto, ON"</span>
                </div>
                <div class="variable-item">
                    <span class="variable-name">Custom Greeting:</span>
                    <span class="variable-value">"Hi! I'm {{AI_agent}}, your {{AI_agent_title}} at {{company_name}}. Ready to get pre-approved for your dream home?"</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª Test Instructions</h2>
            <div class="test-steps">
                <ol>
                    <li><strong>Open Browser Console</strong> (F12) to see debug logs</li>
                    <li><strong>Click the floating widget</strong> in bottom-right corner</li>
                    <li><strong>Click "Call" button</strong> to start the voice call</li>
                    <li><strong>Watch console logs</strong> for "Dynamic variables included" message</li>
                    <li><strong>Listen to agent greeting</strong> - should mention "Sarah", "FluvioAI Mortgage Company"</li>
                    <li><strong>Test conversation</strong> - ask about company hours, phone number, etc.</li>
                </ol>
            </div>

            <button class="btn" onclick="openConsole()">ğŸ“Š Open Browser Console</button>
            <button class="btn btn-success" onclick="testWebhook()">ğŸ”— Test Webhook Directly</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š Expected Console Output</h2>
            <div class="console-output" id="console-preview">
ğŸ§ Fluvio Universal Widget Loading...
ğŸ§ Attempting to load Retell SDK from unpkg...
ğŸ§ SDK loaded from skypack
ğŸ§ Found RetellWebClient in window
ğŸ§ Widget initialized successfully
ğŸ§ Fluvio Universal Widget ready!
ğŸ§ Starting real call...
ğŸ§ Dynamic variables included: {
  "company_contact": "Av Utukuri",
  "company_contact_title": "Head of Sales",
  "company_number": "12894014100",
  "company_hours": "Weekdays 9 to 5PM, Closed on Saturdays and Sundays",
  "AI_agent": "Marissa",
  "AI_agent_title": "Technical Sales Specialist",
  "company_name": "FluvioAI",
  "greeting": "Hi, this is {{AI_agent}} at {{company_name}}. You can speak to me in over 35 languages..."
}
ğŸ§ Starting call with options: { accessToken: "...", retell_llm_dynamic_variables: {...} }
ğŸ§ Call started
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ What to Verify</h2>
            <ul>
                <li>âœ… <strong>Widget appears</strong> with floating button</li>
                <li>âœ… <strong>Console shows</strong> "Dynamic variables included" message</li>
                <li>âœ… <strong>Agent greeting</strong> mentions "Sarah" and "FluvioAI Mortgage Company"</li>
                <li>âœ… <strong>Agent knows</strong> company hours when asked</li>
                <li>âœ… <strong>Agent provides</strong> correct phone number when requested</li>
                <li>âœ… <strong>Conversation flows</strong> naturally with personalized context</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ“ Script Tag Implementation</h2>
            <p>This page uses the following script tag with dynamic variables:</p>
            <div class="variables-display">
&lt;script src="fluvio-universal-widget.js" 
        data-webhook="https://hook.us2.make.com/8inld3fbsnclj96ucur12awsbyjmsxb5"
        data-agent-id="agent_a4cb9032ec31e009d34b9be1a4"
        data-company-name="FluvioAI Mortgage Company"
        data-agent-name="Sarah"
        data-agent-title="Mortgage Specialist"
        data-company-number="1-800-MORTGAGE"
        data-company-hours="Monday-Friday 9am-6pm EST"
        data-company-address="123 Finance Street, Toronto, ON"
        data-greeting="Hi! I'm {{AI_agent}}, your {{AI_agent_title}} at {{company_name}}. Ready to get pre-approved for your dream home?"&gt;&lt;/script&gt;
            </div>
        </div>
    </div>

    <!-- DYNAMIC VARIABLES TEST WIDGET -->
    <script src="fluvio-universal-widget.js" 
            data-webhook="https://hook.us2.make.com/8inld3fbsnclj96ucur12awsbyjmsxb5"
            data-agent-id="agent_a4cb9032ec31e009d34b9be1a4"></script>

    <script>
        function openConsole() {
            alert('Press F12 to open Developer Tools, then click the "Console" tab to see debug logs.');
        }

        async function testWebhook() {
            try {
                const response = await fetch('https://hook.us2.make.com/8inld3fbsnclj96ucur12awsbyjmsxb5', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        agent_id: 'agent_a4cb9032ec31e009d34b9be1a4',
                        dynamic_variables: {
                            company_name: 'FluvioAI Mortgage Company',
                            AI_agent: 'Sarah',
                            AI_agent_title: 'Mortgage Specialist',
                            company_number: '1-800-MORTGAGE',
                            company_hours: 'Monday-Friday 9am-6pm EST',
                            company_address: '123 Finance Street, Toronto, ON',
                            greeting: 'Hi! I\'m {{AI_agent}}, your {{AI_agent_title}} at {{company_name}}. Ready to get pre-approved for your dream home?'
                        }
                    })
                });
                
                const responseText = await response.text();
                console.log('ğŸ§ª Webhook test response:', responseText);
                
                try {
                    const data = JSON.parse(responseText);
                    console.log('ğŸ§ª Parsed webhook data:', data);
                    alert('âœ… Webhook test successful! Check console for details.');
                } catch (e) {
                    console.log('ğŸ§ª Raw webhook response:', responseText);
                    alert('âœ… Webhook responded with raw token. Check console for details.');
                }
            } catch (error) {
                console.error('ğŸ§ª Webhook test failed:', error);
                alert('âŒ Webhook test failed: ' + error.message);
            }
        }

        // Monitor widget loading
        console.log('ğŸ§ª Dynamic Variables Test Page Loaded');
        console.log('ğŸ§ª Testing dynamic variables functionality');
        console.log('ğŸ§ª Expected: Widget should send variables to webhook and pass to Retell');
        
        setTimeout(() => {
            const fab = document.getElementById('fluvio-fab');
            if (fab) {
                console.log('ğŸ§ª âœ… Widget loaded successfully with dynamic variables!');
            } else {
                console.log('ğŸ§ª âŒ Widget failed to load');
            }
        }, 3000);
    </script>
</body>
</html>